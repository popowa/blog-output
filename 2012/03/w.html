<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="ayakomuro" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content="福岡インフラ勉強会第一回報告〜トラブル自慢、受験前対策〜"/>
    <meta property="og:url" content="http://blog.popowa.com/2012/03/w.html"/>
    <meta property="og:site_name" content="popowa"/>
    <meta property="og:type" content="article"/>

    <link rel="canonical" href="http://blog.popowa.com/2012/03/w.html" />

    <title>福岡インフラ勉強会第一回報告〜トラブル自慢、受験前対策〜 | popowa</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" />
    <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" />

    <link rel="stylesheet" type="text/css" href="http://blog.popowa.com/theme/css/main.css" />

    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "5a2ce781d0739000123acd73",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>
</head>

<body id="index">
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h1>
                    <a href="http://blog.popowa.com/">popowa </a>
                </h1>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                        </ul>

<script>
  (function() {
    var cx = '014316853335343165598:-bgzniyqm3y';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
<div id="google-custom-search" class="nav">
    <gcse:search></gcse:search>
</div>
                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
<div class="span10 offset1">
  <section>
    <article>
      <header>
        <h1 class="entry-title">
          <a href="http://blog.popowa.com/2012/03/w.html" rel="bookmark"
             title="Permalink to 福岡インフラ勉強会第一回報告〜トラブル自慢、受験前対策〜">福岡インフラ勉強会第一回報告〜トラブル自慢、受験前対策〜</a></h1>
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="ayakomuro">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
      </header>
      <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="http://blog.popowa.com/author/ayakomuro.html">ayakomuro</a>
    </address>

    in <a href="http://blog.popowa.com/category/misc.html">misc</a>

    on 2012-03-18

        |
        tags:         <a href="http://blog.popowa.com/tag/apache.html">Apache</a>
        <a href="http://blog.popowa.com/tag/infra.html">infra</a>
        <a href="http://blog.popowa.com/tag/mysql.html">MySQL</a>
        <a href="http://blog.popowa.com/tag/php.html">php</a>
        <a href="http://blog.popowa.com/tag/guo-nei-ibento.html">国内イベント</a>



    
</footer><!-- /.post-info -->
        <div class="sharethis-top">
          <span class='st_fblike_hcount' displayText='Facebook Like'></span>
          <span class='st_plusone_hcount' displayText='Google +1'></span>
          <span class='st_twitter_hcount' displayText='Tweet'></span>
          <span class='st_email_hcount' displayText='Email'></span>
        </div>

        <p>福岡インフラ勉強会がAIP
Cafeで行われました！<a href="http://atnd.org/events/26166">http://atnd.org/events/26166</a></p>
<p><a href="http://4.bp.blogspot.com/-Illjm-LN8H4/T2ROTnDHKRI/AAAAAAAAPqM/TI54mJTRX1o/s1600/IMAG0027.jpg"><img alt="" src="http://4.bp.blogspot.com/-Illjm-LN8H4/T2ROTnDHKRI/AAAAAAAAPqM/TI54mJTRX1o/s320/IMAG0027.jpg">{width="320"
height="191"}</a></p>
<p><a href="http://atnd.org/events/26166"></a>  </p>
<h2>■私のトラブル自慢</h2>
<p>ほとんどオフレコなので書けません。。</p>
<ul>
<li>サーバー監視はなるべく常時行うようにする（特定の時間のみの確認だと、それ以外の時に問題が一時的に起こっても知りようが無い->問題を見逃してしまう可能性あり）</li>
<li>トラブルは人が起こす</li>
<li><a href="http://spring-mt.tumblr.com/post/18842191135/kvm-lvm">KVMとLVMで仮想環境を構築(改)
    【ゲストマシン拡張編】</a></li>
<li>ReiserFSもう止めたい;;</li>
<li>edというエディタを知った~~（viの親みたいなものらしい）~~</li>
</ul>
<p>トラブル自慢はあんなことやこんな事まで出て来て、それに対しての対策方法なども一緒に協議されました。</p>
<h2>■チューニンガソン対策</h2>
<p>チューニンガソンがリモート参加OKになったので、その対策を話し合いました。</p>
<p><a href="http://www.zusaar.com/event/218004">第3弾！いろいろチューニングしてパフォーマンスを競うバトルイベント「チューニンガソン」3月24日(土)
開催！ #tuningathon</a></p>
<p>現在出ている条件</p>
<ul>
<li>当日渡された環境を使い、OSやサーバ周りのチューニングでパフォーマンスを競う</li>
<li>サーバ環境がAWS(EC2)でOSはAmazon Linux AMI<br>
   (現在の最新は<a href="http://aws.amazon.com/jp/amazon-linux-ami/latest-release-notes/">Amazon Linux AMI
    2011.09</a>
    )</li>
<li>チューニング対象はwebアプリ</li>
<li>webアプリ自体の改変は対象外</li>
</ul>
<p>ここで山を張ってみます。</p>
<ul>
<li>第一回目はWordPress(PHP,書き込み速度)</li>
<li>第二回目はMediaWiki(PHP,読み込み速度)</li>
<li>第三回目はEC-Cubeかもしれない！？</li>
</ul>
<p>なぜEC-Cubeかというと、</p>
<ul>
<li>ある程度知られているOSSである</li>
<li>PHPである</li>
<li>チューニングし甲斐がありそう</li>
<li>ビジネスでもよく使われている</li>
</ul>
<p>EC-CubeではなくてもPHPで作られたOSSは他にもあります。</p>
<ul>
<li>openPNE</li>
<li>Magento</li>
<li>Xoops</li>
<li>Pukiwiki</li>
</ul>
<p>とかでしょうか？</p>
<p>PHP以外ではRubyか？Pythonか？と思ったのですが、次もPHPではないかと思います。なぜかというと<br>
Ruby</p>
<p>思いつくOSSがRedmineぐらいしかない<a href="http://www.opensourcerails.com/"> 
http://www.opensourcerails.com/</a></p>
<p>Ruby用のHTTPDが沢山ありすぎて、Rubyを使っている人に有利になってしまう可能性がある</p>
<p>Railsはライブラリ扱いなのか？(逆にPHPはFWを使って作った有名なOSSがあまりない気がする)</p>
<ul>
<li>ライブラリだった場合、設定変更や、カスタムが可能なのか？</li>
<li>テンプレートエンジンも変更出来るのか？</li>
</ul>
<p>Python</p>
<ul>
<li>思いつくOSSがTracぐらいしかない</li>
<li>使っている人が圧倒的に少ない</li>
</ul>
<p>Perl使いが、最近PerlもJava側な感じになってきているので今更Perlはねーという事だったので、Perlは対象外としました。Javaもあまり高速しようがないのでは？という意見多数。</p>
<p>それでは高速化について調べてみましょう！</p>
<h2>■言語周りの高速化</h2>
<h3>□PHP</h3>
<p>コンパイルし直してみる<br>
<a href="http://www.php.net/manual/ja/install.unix.php">http://www.php.net/manual/ja/install.unix.php</a> </p>
<ol>
<li>オプションも吟味する<br>
<a href="http://www.php.net/manual/ja/configure.about.php">http://www.php.net/manual/ja/configure.about.php</a> </li>
<li>FastCGIモード(Lighttpd と実績あり）<br>
<a href="http://php.net/manual/ja/install.fpm.php">http://php.net/manual/ja/install.fpm.php</a> </li>
</ol>
<p>バージョンを変更する<br>
Amazon Linux AMI 2011.9で入っているPHPのバージョンはphp-5.3.6です。<br>
PHPの最新は2012/3/1に出たPHP5.4.0です。<br>
<a href="http://php.net/ChangeLog-5.php">http://php.net/ChangeLog-5.php</a><br>
入れ替えるというのも手です。</p>
<p>ネイティブコンパイラを使ってみる</p>
<ol>
<li><a href="http://www.phpcompiler.org/">phc</a></li>
<li><a href="http://www.roadsend.com/">Roadsend</a></li>
<li><a href="https://github.com/facebook/hiphop-php">HipHop for PHP</a></li>
</ol>
<p>アクセラレーターを使う<br>
<a href="http://en.wikipedia.org/wiki/List_of_PHP_accelerators">http://en.wikipedia.org/wiki/List_of_PHP_accelerators</a> </p>
<p><a href="http://pecl.php.net/package/APC">APC</a></p>
<p>eAccelerator :開発が終わっているR.I.P.</p>
<p><a href="http://xcache.lighttpd.net/">XCache　</a><a href="http://xcache.lighttpd.net/"></a></p>
<p><a href="http://www.zend.co.jp/product/zendoptimizer.html">Zend
Optimizer </a><a href="http://www.zend.co.jp/product/zendoptimizer.html"></a></p>
<p><a href="http://www.php-accelerator.co.uk/">PHP Accelerator</a></p>
<p>参考</p>
<ul>
<li><a href="http://gigazine.net/news/20061103_php_accelerator/">PHPアクセラレータで一番高速なのはどれか？</a></li>
<li><a href="http://www.nsworks.com/2011/05/php.html">PHP高速化の手法について(2011/5) </a></li>
<li>インストール方法を予め読んでおくとよいかも。。 </li>
</ul>
<p>設定周り(php.ini)<br>
<a href="http://phplens.com/lens/php-book/optimizing-debugging-php.php">http://phplens.com/lens/php-book/optimizing-debugging-php.php</a></p>
<p>参考URL</p>
<ul>
<li><a href="http://labs.unoh.net/2007/05/phptips.html">PHP最適化tipsまとめサイト</a><a href="http://labs.unoh.net/2007/05/phptips.html"></a></li>
<li><a href="http://matome.naver.jp/odai/2132172467887493001">PHPを使う上で理解しておくべき動作</a><a href="http://matome.naver.jp/odai/2132172467887493001"></a></li>
</ul>
<h3>□Apache</h3>
<p>バージョン確認、可能ならば入れ替え等<br>
最新バージョンはApache 2.4.1<br>
<a href="http://www.apache.org/dist/httpd/Announcement2.4.html">http://www.apache.org/dist/httpd/Announcement2.4.html</a><br>
<a href="http://httpd.apache.org/docs/2.4/new_features_2_4.html">http://httpd.apache.org/docs/2.4/new_features_2_4.html</a><br>
2.4系バージョンが早い</p>
<p>コンパイルし直してみる<br>
<a href="http://httpd.apache.org/docs/2.4/install.html">http://httpd.apache.org/docs/2.4/install.html</a></p>
<ol>
<li>またオプションも吟味する<br>
<a href="http://httpd.apache.org/docs/2.4/programs/configure.html">http://httpd.apache.org/docs/2.4/programs/configure.html</a><br>
   不要ならば削除、高速化しようなら追加等</li>
<li>モードも確認<br>
   worker / prefork - PHPはprefork推奨</li>
</ol>
<p>設定ファイル確認</p>
<p>同時接続数を増やす
(<a href="http://httpd.apache.org/docs/2.4/ja/mod/core.html#MaxKeepAliveRequests">MaxKeepAliveRequests</a>)</p>
<p><a href="http://httpd.apache.org/docs/2.4/ja/mod/core.html#keepalive">KeepAlive</a>はonに</p>
<p>DNSの逆引き停止<br>
HostnameLookups off</p>
<p>ログ系設定<br>
ログをなるべく吐かない設定にする</p>
<ol>
<li><a href="http://httpd.apache.org/docs/2.4/ja/mod/core.html#loglevel">LogLevel</a><br>
<a href="http://httpd.apache.org/docs/2.4/ja/mod/core.html#loglevel"></a></li>
<li><a href="http://httpd.apache.org/docs/2.4/ja/mod/core.html#errorlog">ErrorLog</a>（出力先を/dev/nullにするとか）<br>
<a href="http://httpd.apache.org/docs/2.4/ja/mod/core.html#errorlog"></a></li>
</ol>
<p>モジュール<br>
<a href="http://httpd.apache.org/docs/2.4/mod/">http://httpd.apache.org/docs/2.4/mod/</a></p>
<p>キャッシュ化するモジュール</p>
<ol>
<li><a href="http://httpd.apache.org/docs/2.4/mod/mod_cache.html">mod_cache</a>(アクセス制限を無視するので要注意)</li>
<li><a href="http://httpd.apache.org/docs/2.4/mod/mod_cache_disk.html">mod_cache_disk</a></li>
<li><a href="http://httpd.apache.org/docs/2.4/mod/mod_file_cache.html">mod_cache_file</a>(使用要注意)</li>
</ol>
<p>キャッシュを取り扱うモジュール</p>
<ol>
<li><a href="http://httpd.apache.org/docs/2.2/ja/mod/core.html#fileetag">ETags</a><a href="http://httpd.apache.org/docs/2.2/ja/mod/core.html#fileetag"><br>
</a></li>
<li><a href="http://httpd.apache.org/docs/2.4/ja/mod/mod_expires.html">mod_expires</a></li>
</ol>
<p>プロキシ系モジュール</p>
<ol>
<li>mod_proxy</li>
<li>mod_proxy_balance</li>
<li>mod_proxy_connect</li>
<li>mod_proxy_express</li>
<li>mod_proxy_fcgi</li>
<li>mod_proxy_fdpass</li>
<li>mod_proxy_html</li>
<li>mod_proxy_http</li>
<li>mod_proxy_scgi</li>
</ol>
<p>圧縮系モジュール</p>
<ol>
<li><a href="http://httpd.apache.org/docs/2.3/ja/mod/mod_deflate.html">mod_deflate</a>
    クライアントへ送られる前にコンテンツを圧縮する </li>
<li><a href="http://code.google.com/speed/page-speed/docs/module.html">mod_pagespeed</a>(CSSやJSなど不要な改行、スペースを取り除く)<br>
<a href="http://code.google.com/speed/page-speed/docs/module.html"></a></li>
</ol>
<p>参考URL</p>
<ol>
<li><a href="http://www5.plala.or.jp/vaio0630/apache/apache_up.htm%20">Apache高速化計画</a></li>
<li><a href="http://www.atmarkit.co.jp/flinux/rensai/apache15/apache15a.html">最終回　Apacheパフォーマンス・チューニングの実践</a>
    ,
    <a href="http://www.atmarkit.co.jp/flinux/rensai/apache16/apache16a.html">2ページ目</a></li>
</ol>
<h3>□Ngix</h3>
<p><a href="http://nginx.org/ja/">http://nginx.org/ja/</a><br>
※高速なNgixではあるが、モジュールに関してはApacheの方が充実しているので、そちらでしのぐ方法もある<br>
参考URL</p>
<ol>
<li><a href="http://labs.unoh.net/2009/08/tips_for_nginx.html">Tips for nginx</a></li>
</ol>
<h3>□DB</h3>
<p>DBはMySQLじゃないかなーと思います。何故かというとPostgreSQLはAWSでは提供されておらず、またOracleのライセンスを負担するほどでもないと思うからです。Oracleがスポンサーだったらまた違ってくると思うけど
（・∀・）ﾆﾔﾆﾔ</p>
<p>バージョン確認、可能ならば入れ替え等</p>
<ol>
<li>MySQL5.1系(<a href="http://dev.mysql.com/doc/refman/5.1/en/news-5-1-61.html">5.1.61</a>)</li>
<li>MySQL5.5系(<a href="http://dev.mysql.com/doc/refman/5.5/en/news-5-5-21.html">5.5.21</a>)</li>
<li>MySQL5.6系(<a href="http://dev.mysql.com/doc/refman/5.6/en/news-5-6-4.html">5.6.4</a>) </li>
</ol>
<p>コンパイルし直してみる<br>
<a href="http://dev.mysql.com/doc/refman/5.1/ja/quick-install.html">http://dev.mysql.com/doc/refman/5.1/ja/quick-install.html</a></p>
<p>設定ファイル確認</p>
<ol>
<li>参考URL >> 
    <a href="http://blog.layer8.sh/ja/2011/12/23/mysql%E3%82%92%E9%AB%98%E9%80%9F%E5%8C%96%E3%81%97%E3%81%9F%E3%81%84%E3%81%A8%E3%81%8D%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0/">MySQLを高速化したいときのチューニング方法</a></li>
<li>スレッド数、同時接続数 </li>
<li>スロークエリログなどをみながら</li>
<li>メモリ周りや、バッファ</li>
<li>キャッシュ</li>
</ol>
<p>Index作成、削除</p>
<p>MySQL Proxy<br>
<a href="https://launchpad.net/mysql-proxy">https://launchpad.net/mysql-proxy</a><br>
静的/動的を分離させるなど</p>
<p>コネクションプール：遅そうなので却下<br>
<a href="http://d.hatena.ne.jp/qinglong/20051025/p1">SQL Relay で PHP + MySQL
コネクションプーリング</a></p>
<p>参考URL</p>
<ol>
<li><a href="http://blog.layer8.sh/ja/2011/12/23/mysql%E3%82%92%E9%AB%98%E9%80%9F%E5%8C%96%E3%81%97%E3%81%9F%E3%81%84%E3%81%A8%E3%81%8D%E3%81%AE%E3%83%81%E3%83%A5%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0/">MySQLを高速化したいときのチューニング方法</a></li>
<li><a href="http://nippondanji.blogspot.jp/2009/02/mysql10.html">MySQLを高速化する10の方法</a>（漢のコンピュータ道はとりあえず一通り見ておく） </li>
</ol>
<h3>□OS</h3>
<p>iptablesを使って使用するポートを限定する</p>
<ol>
<li><a href="http://arisonsvr.org/web/maincontents/serverset/iptables/iptable.html">iptableの設定-CENTOSでアリソンサーバ</a></li>
</ol>
<p>参考URL</p>
<ol>
<li><a href="http://d.hatena.ne.jp/laclefdor/20101125/1290589615">CentOSをたったの3ステップで高速化する方法</a></li>
<li><a href="http://weble.org/2011/08/14/centos-config">さくら VPS + CentOS
    のチューニングや高速化もっとこうすれば良かった作業まとめ</a><a href="http://weble.org/2011/08/14/centos-config"></a></li>
</ol>
<h3>□計測ツール</h3>
<p>アドオン</p>
<ul>
<li><a href="http://developer.yahoo.com/yslow/">yslow</a></li>
<li><a href="https://addons.mozilla.org/ja/firefox/addon/firebug/">firebu</a></li>
</ul>
<p>コマンド</p>
<ul>
<li>top  / sar / free / vmstat / iostat / perfstat / mpstat / pmap</li>
<li>netstat / ss / iptraf / strace / gdb / ps / w / tcpdump</li>
<li><a href="http://www.cyberciti.biz/faq/linux-performance-tools-to-troubleshoot-problem/">http://www.cyberciti.biz/faq/linux-performance-tools-to-troubleshoot-problem/</a></li>
</ul>
<p>アプリ</p>
<ul>
<li><a href="http://jmeter.apache.org/">Apache JMeter</a></li>
<li><a href="http://gigazine.net/news/20070424_profile_php/%20">PHPをより高速化するプロファイリングツールあれこれ</a></li>
</ul>
<h3>□思いついた事</h3>
<p>書き込み速度を重要視する場合は、Master
DBのカラムには書き込まない。出力するバイナリーログは正常なのでslave側は正しいデータが入っている<br>
MySQLとMariaDBは互換はある程度ありそう。。だけどあまり得策ではなさそうだ。。<a href="http://kb.askmonty.org/en/mariadb-versus-mysql">http://kb.askmonty.org/en/mariadb-versus-mysql</a><br>
条件が分からないので、ファイルシステムを変えてもよいのか、とかサーバ側はどこまで手を入れてよいのか分からず一時暴走w</p>
<p>こちらも参考になりました</p>
<p><strong><a href="http://www.slideshare.net/sh1mmer/websites-on-speed-2604639" title="Websites On Speed">Websites On
Speed</a></strong></p>
<p>View more <a href="http://www.slideshare.net/">presentations</a> from <a href="http://www.slideshare.net/sh1mmer">Tom
Hughes-Croucher</a></p>
<h3>□まとめ</h3>
<p><strong>[福岡熱い！]</strong>
チューニンガソンに関わらず非常に勉強になる会でした〜！<br>
福岡インフラ勉強会が気になる方はFacebook Groupに今すぐ参加！<br>
<a href="https://www.facebook.com/groups/100825430047874/">https://www.facebook.com/groups/100825430047874/</a></p>
<p>追記：チューニングソンと書いていたので、チューニンガソンに変更<br>
edはviの親ではないらしい</p>

        <div class="sharethis-bottom">
          <span class='st_fblike_hcount' displayText='Facebook Like'></span>
          <span class='st_plusone_hcount' displayText='Google +1'></span>
          <span class='st_twitter_hcount' displayText='Tweet'></span>
          <span class='st_email_hcount' displayText='Email'></span>
        </div>
      </div><!-- /.entry-content -->

    </article>
  </section>
</div>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                    <p>
                        This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                    </p>
                    <p>
                        <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a> is a responsive theme designed by <a href="http://jsliang.com/">jsliang</a> and <a href="https://github.com/jsliang/pelican-fresh/graphs/contributors">contributors</a>.
                        Special thanks to <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> and <a href="http://getbootstrap.com/">Twitter Bootstrap</a>.
                    </p>
                </address>
            </div>
        </div>
    </footer>

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-845207-15']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>
</body>
</html>